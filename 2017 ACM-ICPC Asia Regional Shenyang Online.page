# Contest Info

date 2017.09.10 12:00-17:00

# Solutions

## A. string string string

**题目大意**：给定一个字符串 $S$，和一个正整数 $k$，问 $S$ 有多少个恰好出现 $k$ 次的子串。

**题解**：sam 裸题。直接逆拓扑序递推算出每个状态 $S$ 的 $|Right_S|$ 即可。

## G. mustedge mustedge mustedge

**题目大意**：给出一个简单无向图，有 $n\le10^5$ 个点和 $m\le10^5$ 条边。之后给出 $q\le10^5$ 次操作，每次操作添加一条新的无向边连接点 $u$ 和 $v$（可能重边），或者询问从点 $u$ 到 $v$ 的所有路径中，有多少条边是必须经过的($1\le u\not=v\le n$)。

**题解**：先随便求一个原图的生成树，然后将不在树中的边当做操作 $1$ 处理。然后，操作 $1$ 就是将树中 $u$ 到 $v$ 的路径中还存在的边删掉，操作 $2$ 就是询问树中 $u$ 到 $v$ 的路径中还存在的边的数量。

法一：用 dfs 序加上树状数组来维护每个点到根的路径上存在的边的数量，删去一个点时对它子树对应的 dfs 序区间进行修改，时间复杂度为 $\mathcal{O}(\log{n})$。询问的时候，分别求 $u$，$v$ 和 $\text{lca}(u,v)$ 的答案计算一下即可，时间复杂度为 $\mathcal{O}(\log{n})$。因为每条边只会被删除一次，可以使用并查集维护删边，这样修改的总时间复杂度为 $\mathcal{O}(n\log{n})$。

整个算法的时间复杂度为$\mathcal{O}((m+q)\log{n})$，空间复杂度为 $\mathcal{O}(n)$。但是因为要存很多信息，特别是要求 $\text{lca}$ 时使用了 Tarjan，导致实际使用的内存偏多，场上没能成功卡进 32M 的空间限制（赛后给两个递归的函数加上了inline，少了近 2K 内存，过掉了）。

法二：对生成树进行树链剖分，然后用树状数组维护 dfs 序，删去一条边直接在树状数组中进行修改，询问时则一边跳重链一边询问每一段连续区间的答案。同样使用并查集删边。

整个算法的时间复杂度为$\mathcal{O}((m+q)\log{n}+q\log^2{n})$，空间复杂度为 $\mathcal{O}(n)$。由于要记录的信息较少，特别是不需要花额外的开销去计算 $\text{lca}$，只需要 20M 的内存就可以轻松过掉这题。

## H. transaction transaction transaction

**题目大意**：给出一个 $n\le10^5$ 个点的树，点 $i$ 的点权为 $p_i$，每条边 $e$ 还有一个边权 $w(e)$。从点 $u$ 到点 $v$ 的收益为 $\displaystyle p_v-p_u-\sum\limits_{e \in \text{path}(u,v)} w(e)$。现在让你选择一个起点和一个终点，求最大的收益。

**题解**：直接树分治即可，但是需要注意优化一下常数，或者使用靠谱的读入优化。

# Replay and Summary

## Replay

D 先看了 A 题，发现是个大水题直接莽 sam 就可以了，交给 W 来写。W 很快写完，然后发现没给字符集大小，心大直接不管交了一发，就过掉了。Z 发现 D 是个水题，写过也 a 了。W 发现 B 已经被 a 穿了，但是看了看没什么思路啊，就交给刚做完 D 的 Z， Z 看了两眼莽了个式子过掉了。E 看了看觉得是个递推式，W 正准备写一个 BM 模板上去，结果 Z 就说过掉了，W 被吓得不敢说话。

H 题 W 看了之后给 D 说是一个树分治的题，然后 D 说他来写，就交给 D 写去了。期间 Z 发现 L 是个水题，写了一发，然后因为没仔细看空间限制（32MB 真是小啊）而 MLE 了一发，奠定了本场疯狂 MLE 的基础。D 写完 H 各种错误（wa MLE TLE ce），W 赶紧让他冷静下来，然后发现可以优化，优化之后过掉了。

F 题 W 之前看成了取绝对值，看了看 clarification 之后发现不是绝对值，Z 觉得直接 dp 转移就可以了。 W 给 Z 出了点数据，Z 怎么都跑不过。各种调试之后，交了一发 MLE，感人肺腑。改成 vector 之后过掉了。

D 跟 W 讨论了一下，觉得 G 似乎可以用 lct 或者树剖随便怎么搞一搞。此时二人完全没有吸取到之前 MLE 的教训，更没有仔细查看时间空间限制。W 就让 D 去写了。D 写了之后先是 TLE，在本地从 7s 优化到 1s 之后提交发现 MLE，最绝望的是怎么修改都比 32MB 多一点点。

W 和 Z 趁 D 在刚 G 的时候，做了一个魔方，然后打了一个表来辅助搜索。缓慢稳定地 1a 了 I 题。最后半小时 W 想到了 J 的贪心，然后没写完。虽然不知道为什么出题人这么缺内存，但是弊队总是不注意时间空间限制的毛病得改改了。