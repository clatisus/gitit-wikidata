# Contest Info

date: 2017.10.06 13:00-18:00

[practice link](http://codeforces.com/gym/100962/)

# Solutions

## A. ABBA

**题目大意**：设 $\alpha = (a_{1}, \cdots, a_{n}),\beta=(b_{1},\cdots,b_{m})$ 是两个向量，定义两个向量的乘积 $\alpha\times\beta$ 为一个 $n\times m$ 的矩阵，它的第 $i$ 行第 $j$ 列是 $a_{i}b_{j}$ 。现在给你一个矩阵，问你它最少能写成几个矩阵的和，其中每个矩阵是两个向量的乘积。

**题解**：等价于用向量 $\alpha$ 乘上 $\beta$ 的每一项作为系数，去消去相应的列。所以答案是该矩阵的秩。

## B. Black Sabbath

**题目大意**：给你一个长方形，内部有 $n$ 个圆，圆之间两两相离，圆和矩形的边界也相离。现在要你把长方形分成 $n$ 块，每块要正好完整地包含一个圆，并且是一个凸包。

**题解**：半平面交。对于每个圆，我们在它和其它圆中间画一条直线将他们分开，令这个半平面指向这个圆这一侧，再加上长方形的四个边界定义的四个半平面，这些半平面的交就是这个圆所在的凸包。这题有些吃精度，由标程得到启发，我们在两圆（设为 $i,j$）圆心连线的 $\displaystyle{\frac{d^{2}+r_{i}^{2}-r_{j}^{2}}{2d}}$ 处画线，能取得比较好的精度。

## C. Mr. Credo

**题目大意**：平面上有一些灯塔，每个灯塔可以照亮一个无穷大的扇形，求一个平面上没有被照亮的、半径为 $1$ 的圆。保证如果将所有灯塔移动到一点，那么不论它们怎么旋转都不能照亮整个平面。

**题解**：根据题目的保证容易知道一定是有解的。同时我们注意到，输入坐标的绝对值在 $50$ 以内，比答案要求的范围 $10^{9}$ 小得多。于是我们可以忽略掉输入的灯塔的坐标，将它们看作都摆放在原点。由于输入扇形的角度是整数，我们容易找到一个整的角秒没有被照亮，我们只需要在它的角平分线并且离原点非常远的地方找一个圆就好了。

## D. Deep Purple

unsolved

## E. Elvis Presley

**题目大意**：给出两个整数 $a$ 和 $b$ （$1\le a,b\le10^9,a\not=b$ ）。求一个最小的极大集合，要求包含 $a$ 和 $b$ ，且集合内任意两个数转成二进制（不含前导零）后都不是彼此的前缀。

**题解**：将 $a$ 和 $b$ 的二进制串求出，如果 $a$ 和 $b$ 就不满足条件则无解。否则，建出 $a$ 和 $b$ 的 trie，则最少的方案就是把，在 trie 的每个分支处，将不能走的那个儿子表示的串加入集合。复杂度 $\mathcal{O}(\log{a}+\log{b})$。

## F. Frank Sinatra

**题目大意** ：给定一棵边上带权的树，每次询问两个点，求两点路径上的权值集合的 $\text{mex}$ 。

**题解** ：树上莫队。然后对权值分块求 $\text{mex}$， 注意大于 $n$ 的权值可以令其为 $n$ 。

## G. Green Day

**题目大意** ：给定整数 $n\geq 2$ ，要求你构造一个 $n$ 个点的无自环无重边的无向图。并且每条边被染成 $k$ 种颜色中的一种，每种颜色的所有边构成一棵原图的生成树。设颜色 $c$ 的生成树为 $T_c$ 。还要满足：对任意两种颜色 $c,d$ ，对任意两个不同的点 $u,v$ ，有 $\text{path}_{T_c}(u,v)\cap \text{path}_{T_d}(u,v)=\{u,v\}$ 。

**题解** ：一开始很容易想到对每种颜色 $c$ ，$T_c$ 构成一个菊花图。那么对特定的一种颜色，我们设菊花为点 $w$， 那么显然对于该种颜色来说，任意两点 $u,v$ 的路径上除了 $u,v$ 最多再包含点 $w$ 。但是这样显然是不行的，因为菊花点的度数为 $n-1$ ，不能连出其他颜色的边，不满足题意。

我们再考虑 $T_c$ 中有两个菊花点。我们将其余点平均分成两部分，各连一个菊花，然后两个菊花点之间连一条边。对于其他的颜色来说，我们选取没被选过的点作为菊花即可。这样我们一共需要 $2k$ 个点。稍一验证就可以发现满足题意，任意两点 $u,v$ 之间的路径最多包含四个点 $\{u,v,w_1,w_2\}$ ，其中 $w_1,w_2$ 是菊花点。在另一种颜色的生成树上，$u,v$ 之间的路径最多为 $\{u,v,w_1',w_2'\}$ ，因为我们选取的菊花不同，所以交点只会为 $\{u,v\}$ 。

具体实现的时候，可以在正 $2k$ 边形上连边，写代码方便一点。

## H. Hans Zimmer

**题目大意**：给你一个 $w\times h$ 的矩形，要对它切 $n$ 刀，每刀等概率地选择横/竖切，再等概率地选择下刀位置。问切完之后最小的矩形面积的期望。

**题解**：首先 $wh$ 可以最后乘。注意到横竖互不影响，于是我们可以枚举横切有多少刀，设为 $i$ 。那么这种情况对答案的贡献就是 ${n \choose i}/2^n \cdot E_i$ 。再考虑 $E_i$  的计算，稍微积一下分可以发现切 $i$ 刀在一维下的期望长度是 $L_i=\frac{1}{(i+1)^{2}}$ 。另外一边切了 $n-i$ 刀，于是 $E_i=L_i\cdot L_{n-i}=\frac{1}{(i+1)^{2}(n-i+1)^{2}}$ 。注意用 log 控制精度，并且输出使用 %lg。

------

coldwater's comment

$L_i$ 的具体计算过程：切 $i$ 刀将一个长为 $1$ 的线段切成了 $i+1$ 段，我们假设第一段是最小的，设长度为 $x$，其余的段长度依次为 $x_1,x_2,\dots,x_i$ 。那么我们有：

$$
\begin{cases}
\sum_{j=1}^ix_i=1-x\\
x_i\geq x
\end{cases}
$$

稍加转换，即为：

$$
\begin{cases}
\sum_{j=1}^ix_i=1-(i+1)x\\
0\leq x_i\leq 1-(i+1)x
\end{cases}
$$

我们考虑 $i$ 维空间中原点沿着各坐标轴正方向延伸 $1-(i+1)x$ 处围起来的面积 $S_x$ 。那么有 $P(x)$ 与 $S_x$ 成正比，于是我们得到 $P(x)=k\big(1-(i+1)x\big)^i$ ，再由 $\int_0^{1/(i+1)}P(x)\text{d}x=1$ ，我们可以积分得到 $k=(i+1)^2$ 。那么 $L_i=\int_0^{1/(i+1)}P(x)\cdot x\text{d}x$，很容易积得 $L_i=\frac{1}{(i+1)^2}$。 

## J. Jimi Hendrix

**题目大意**：给出一棵 $n$ 个节点的树，每条边上有一个英文小写字母。再给出一个长度为$m\le n-1$ 的只由英文小写字母组成的字符串 $S$ ，问是否存在两点 $u$ 和 $v$ ，满足 $S$ 是从 $u$ 走到 $v$ 的路径形成的字符串的子序列。

**题解**：

法一：考虑用树分治来枚举所有路径，每一层分治时记录每个子树自底向上匹配，最多能让 $S$ 多长的前缀成为子序列，以及最多能让 $S$ 多长的后缀成为子序列，如果两个不同子树的答案可以覆盖完 $S$ ，那么就有答案。复杂度$\mathcal{O}(n\log{n})$。

法二：直接树 dp 记录往下最长的前缀和后缀形成的子序列。因为前缀和后缀要来自不同的子树才可以，所以记录一下最大和次大。

