# Contest Info

date: 2018.08.19 12:00-17:00

[practice link](https://www.nowcoder.com/acm/contest/148#question)

# Solutions
## E. Rikka with Equation

**题目大意**：设 $\{A\}$ 是一个多重集，定义 $f(A,m)$ 为同余方程 $A_{1}x_{1}+\cdots+A_{n}x_{n}\equiv0\pmod{m}$ 在 $[0,m-1]^{n}$ 上的解数。给你一个多重集 $S$ 和 $M$，求 $\bigoplus_{m=1}^{M}\sum_{A\in S,|A|\ge1}f(A,m)$。

**题解**：首先证明：$f(A,m)=m^{|A|-1}gcd(A,m)$。容易发现 $A_{2}x_{2}+\cdots+A_{n}x_{n}\equiv0\pmod{gcd(m,A_{1})}$ 是方程有解的必要条件，且对于任意一个这样的 $x_{2},\cdots,x_{n}$ 的解，我们恰有 $gcd(m,A_{1})$ 个 $x_{1}$ 的解，因此我们可以递归地计算：$f(A,m)=gcd(m,A_{1})(\frac{m}{gcd(m,A_{1})})^{|A|-1}f(A-\{A_{1}\},gcd(m,A_{1}))$。使用数学归纳法即可证明上述结论。

那么对于一个 $m$，我们所求即为 $\sum_{A\in S,|A|\ge1}m^{|A|-1}gcd(A,m)$。设 $f(u)$ 表示 $u\mid gcd(A,m)$ 的所有 $A$ 的 $m^{|A|-1}$ 之和，$g(u)$ 表示 $u=gcd(A,m)$ 的所有 $A$ 的 $m^{|A|-1}$ 之和，那么答案即为 $\sum_{u\mid m}ug(u)$。$f(u)$ 较为容易计算，设 $\text{cnt}_{u}$ 表示输入的数列中 $u$ 的倍数的数量，那么有 $f(u)=\sum_{i=1}^{\text{cnt}_{u}}{\text{cnt}_{u}\choose i}m^{i-1}=\frac{(m+1)^{\text{cnt}_{u}}}{m}$。根据容斥原理，我们又有 $g(u)=\sum_{u\mid d,d\mid m}f(d)\mu(\frac{d}{u})$。这里已经可以计算了，感受了一下复杂度应该是 $\mathcal{O}(n\log^{2}n\log B)$。

但是我们还可以继续化简。原式等于
$$
\begin{aligned}
&\sum_{u\mid m}u\sum_{u\mid d,d\mid m}f(d)\mu(\frac{d}{u})\\
=&\sum_{d\mid m}f(d)\sum_{u\mid d}u\mu(\frac{d}{u})\\
=&\sum_{d\mid m}f(d)\varphi(d)
\end{aligned}
$$
时间复杂度 $\mathcal{O}(n\log n\log B)$。

~~这尼玛还不是sb题?~~

# Dirt Replay

F: `-4` 前三次代码错误但是 TLE，抠常数；算法正确之后，没有把 log 去掉，TLE

J: `-1` 清空数组没有清 ch[0]