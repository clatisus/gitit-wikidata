# Contest Info

[practice link](https://cn.vjudge.net/contest/172382)

# Solutions

## A. Password Suspects

**题目大意**：给定 $n,m$，以及 $m$ 个长度在 $10$ 以内的字符串（仅由小写字母组成）。问有多少个长度为 $n$ 的字符串，同时以这 $m$ 个字符串为子串。如果不超过 $42$ 个，那么输出方案。$1\leq n\leq 25,0\leq m\leq 10$。

**题解**：将所有的给定串插入 ac 自动机，构建一个 trie 图，在 trie 图上进行 dp。trie 图的每个节点记录一个集合 $f[p]$，表示哪些给定串是节点 $p$ 的后缀。因为给定串一定是 trie 图的前缀，所以我们插入的时候在终止节点插入元素，然后沿着 fail 链向下合并。也即 $f[p] = f[p] \cup f[fail[p]]$。 $dp[p][len][s]$ 表示从节点 $p$ 开始，当前长度为 $len$，当前包含给定串集合为 $s$ 的方案数量。从 $dp[\text{root}][0][\emptyset]$ 开始自顶向下 dp。

## G. Palindromic Border 

**题目大意**：定义一个串的 Palindromic Border 如下：

- 它是回文的
- 它既是原串的前缀，也是原串的后缀

求给定串的所有子串（只要起始的位置不同就认为是不同的子串）的 Palindromic Border 的个数之和。

**题解**：建出原串的回文树，搞出所有本质不同的回文子串和其出现次数，则每种子串的贡献就是$\binom{k}{2}$，$k$ 是该子串在原串中出现的次数。

## H. Yong Zheng's Death 

**题目大意**：给出一个字符串集合 $S = \{ s_1, s_2, \dots, s_n \}$，$|s_i| \leq 30$ 。从 $S$ 中任取两个串的前缀拼成一个字符串，问共有多少个本质不同的串。

**题解**：对 $S$ 建一个 ac 自动机，得到 $S$ 中本质不同的前缀共有 $cnt$ 个，则答案为 $cnt^2$ 减去重复的情况。

考虑如何计算重复的情况，对于最终得到的一个串 $C = A_1 + B_1 = A_2 + B_2 = \cdots = A_k +B_k$ ，$A_i$ 和 $B_i$ 的拼接线为 $l_i$，我们规定 $l_i$ 最靠近 $C$ 的开头位置的方案是合法的，其它的都是不合法的（重复方案）。 

我们枚举这个拼接线，也即枚举前缀 $B$ ，然后减去恰在当前拼接线右侧的那个拼接线的情况。那么它所对应的前缀 $B^{'}$ 是 $S$ 中的一个前缀，且是 $B$ 的最长的后缀。显然，这就是 $B$ 在 ac 自动机的 $fail$ 指针指向的位置。之后就要考虑有多少种不同的非空前缀 $A$ 和 $A^{'}$ 能满足 $A + B = A^{'} +B^{'}$。

稍微画图可以发现，$A^{'} = A + X$，$B = X + B^{'}$，其中 $X$ 为 $B$ 的一个前缀。我们要求的是 $A^{'}$ 的数量，就等于 $S$ 中以 $X$ 作为后缀的前缀的数量，直接在 $AC$ 自动机中询问 $X$ 串在 $fail$ 树中的子树大小即可（记得减去 $A^{'} = X$ 的情况， $A$ 不能为空）。因为串的长度不超过 $30$ ，我们可以直接在 ac 自动机中由 $B$ 向上走就可以找到 $X$。

##  L. The Problem to Slow Down You

**题目大意**：给出两个只有小写字母的字符串，求这两个串有多少对公共子串是回文的。

**题解**：对两个串分别建回文树，然后在两棵树上分别走。一开始同时从奇数串和偶数串的根出发，只走两棵树上都有的路，然后每个位置都是两个串本质不同的公共回文子串，对答案的贡献就是 A 串中出现的次数乘以 B 串中出现的次数。