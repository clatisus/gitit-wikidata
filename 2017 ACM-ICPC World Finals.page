# Contest Info

date: 2019.03.26 16:25-21:25

[practice link](https://codeforces.com/gym/101471/)

# Solutions

## D. Money for Nothing

**题目大意**：有$m\le5\times10^5$个卖家，第$i$个卖家从第$d_i$天来到市场，从第二天开始以$p_i$的单价售卖商品。同时有$n\le5\times10^5$个买家，第$i$个买家以$q_i$的单价收购商品，并将于第$e_i$天离开市场。有一个中间商，将选择一个卖家$i$和一个买家$j$，在第$d_i+1$天至第$e_j-1$天都会从卖家$i$处转卖一件商品给买家$j$以赚取差价。最大化收益。

**题解**：

**solution 1**：

$$
ans = \max_{i\in[1,n]}(\max\limits_{e_i\ge d_j} (q_i-p_j)\cdot(e_i-d_j))
$$

对于两个卖家$i​$和$j​$，如果$d_i\le d_j​$且$p_i\le p_j​$，那么卖家$j​$一定没有卖家$i​$更优。

对于两个买家$i​$和$j​$，如果$e_i\le e_j​$且$q_i\le q_j​$，那么买家$i​$一定没有买家$j​$更优。

只保留有用的买家和卖家，并分别按$d$和$e$从大到小排序，令$u(i)$为$\max\limits_{e_i\ge d_j} (q_i-p_j)\cdot(e_i-d_j)$取到最值的最大的$j$，则$u(i)$单调不减，直接分治即可，时间复杂度$O(n\log{n})$。

**proof**.

若$j>i$且$u(j)<u(i)$，则有
$$
\tag{1} (e_i-e_j)<0 \land (q_i-q_j)>0
$$

$$
\tag{2} (d_{u(i)}-d_{u(j)})>0\land (p_{u(i)}-p_{u(j)})<0
$$

$$
\tag{3}(q_j-p_{u(j)})\cdot(e_j-d_{u(j)})>(q_j-p_{u(i)})\cdot(e_j-d_{u(i)})
$$

$$
\tag{4}(q_i-p_{u(j)})\cdot(e_i-d_{u(j)})\le(q_i-p_{u(i)})\cdot(e_i-d_{u(i)})
$$

(3)和(4)分别变形化简得到：
$$
\tag{5}(p_{u(i)}-p_{u(j)})\cdot e_j+q_j\cdot(d_{u(i)}-d_{u(j)})-p_{u(i)}\cdot d_{u(i)}+p_{u(j)}\cdot d_{u(j)}>0
$$

$$
\tag{6}(p_{u(i)}-p_{u(j)})\cdot e_i+q_i\cdot(d_{u(i)}-d_{u(j)}) - p_{u(i)}\cdot d_{u(i)} + p_{u(j)}\cdot d_{u(j)}\le 0
$$

由(5)和(6)可以得到：
$$
\tag{7} (p_{u(i)}-p_{u(j)})\cdot (e_i-e_j)+(q_i-q_j)\cdot(d_{u(i)}-d_{u(j)}) < 0
$$
而(7)与(1)(2)矛盾，因此不可能存在$j>i$且$u(j)<u(i)$.
