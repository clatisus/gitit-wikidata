# 数据结构

## cf1017G

[portal](https://codeforces.com/contest/1017/problem/G)

$n\le10^5$个点的树，以$1$为根，一开始每个点都是白色，$q\le10^5$次操作，操作有3种：

- 从点$v$开始，如果$v$为白色，将$v$变为黑色，否则对于$v$的所有儿子递归地执行这一操作
- 将点$v$所在子树全部变为白色
- 询问点$v$当前的颜色

将询问分块，每块的关键点建出虚树，边上记录白点个数，则对于关键点暴力做操作即可。

维护$lazy[u]$为从$u$往下要染黑的距离，当一条边的白点都被染黑后递归到下面的关键点，清空操作清空$lazy[u]$并将白点个数改为原树中缩掉的节点个数。

每块询问做完后，再将非关键点的颜色修改正确，对于被清空过的点要先修改改为白色再判断是否可以被染黑。

复杂度$O(n\sqrt{n})$.

[Code](https://codeforces.com/contest/1017/submission/42310637)