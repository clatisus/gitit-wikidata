# Contest Info

date: 2018.06.29 09:00-14:00

[practice link](https://vjudge.net/contest/236056#rank)

# Solutions
## B. Master of Phi
签到题。

## C. Hakase and Nano

**题目大意**：将 `Nim` 游戏的规则改为其中一个人（`h`）每次必须连续进行两次操作（最后一次除外），拿到最后一颗石子的人胜。分析 `h` 在不同先后手情况下的输赢情况。

**题解**：

- 若每堆石子都只有 $1$ 颗

    - 若 `h` 先手，则 $n\equiv0\pmod{3}$ 时 `h` 负，否则 `h` 胜。
    - 若 `h` 后手，则 $n\equiv1\pmod{3}$ 时 `h` 负，否则 `h` 胜。

- 若恰有 $1$ 堆石子多于 $1$ 颗，其余每堆石子都只有 $1$ 颗

    - 若 `h` 先手，则 `h` 必胜。他有两种不同的选择：将那堆石子分两次取完，或者一次取完后再取另外一堆石子。这两种选择得到的新 $n$ 恰好相差 $1$，必有一种是 `h` 的胜态。
    - 若 `h` 后手，则 $n\equiv2\pmod{3}$ 时 `h` 胜，否则 `h` 负。$n\equiv0\pmod{3}$ 时，另一个人可以将那一堆石子取到只剩 $1$ 颗；$n\equiv1\pmod{3}$ 时，另一个人可以将那堆石子全部取走；否则他不论怎么取都是 `h` 的胜态。

- 若多于 $1$ 颗石子的堆数大于 $1$

  `h` 必胜，我们归纳地证明这一结论：

    - 若 `h` 先手
        - 若恰有 $2$ 堆石子多于 $1$ 颗，其余每堆石子都只有 $1$ 颗。`h` 有两种不同的选择：将两堆石子都取完，或者取完一堆石子，另一堆石子取到只剩 $1$ 颗。这两种选择得到的新 $n$ 恰好相差 $1$，必有一种是 `h` 的胜态。
        - 若多于 $2$ 堆石子多于 $1$ 颗。`h` 可以分两次取完一堆石子，必然是他的胜态。
    - 若 `h` 后手，由于另一个人只能操作一次，因此他取完后至少还有一堆石子大于 $1$ 颗，这必然是 `h` 的胜态。

## H. Master of Connected Component

**题目大意**：给定一个初始只有 $m$ 个点，没有边的图 $G$，和两棵均以 $1$ 为根的树 Ta 和 Tb。树 Ta 和 Tb 上每个点存储的是图 $G$ 中的一条边。

现在问你对于 $\forall i, i \in [1, n]$，把两棵树中，点 $i$ 到根的两条路径上所有点存储的边插入图 $G$，有多少个连通块。

**题解**：我们按照 SCOI 王室联邦的树分块方法，把两棵树各分为 $\sqrt n$ 块。这种分块方法下，每一块要么连通，要么加上它们的 lca 之后连通。我们用这个 lca 来代表这个块，那么显然 lca 也只有 $\sqrt n$ 个。

考虑两棵树的所有块的 lca，这样的 pair 只有 $\sqrt n \times \sqrt n = n$ 类。我们将询问分类，对于每一类进行处理。处理这一类的时候，我们先把图 $G$ 的状态转移到两棵树对应的 lca 处。然后处理每一个询问，处理完每个询问的时候，都用可撤销的启发式合并并查集恢复状态，以供下个询问。

这样，在类的内部，每个询问最多转移 $\mathcal{O}(\sqrt n)$ 次。考虑类之间，我们在两棵树中把各自块的 lca 打上标记，然后 dfs 第一棵树，对于有标记的点，我们从头开始 dfs 第二棵树。这样的复杂度是 $\mathcal{O}(n\sqrt n)$ 的。