# Contest Info

date 2017.08.19 12:00-17:00

[practice link](http://acm.hdu.edu.cn/search.php?field=problem&key=2017%D6%D0%B9%FA%B4%F3%D1%A7%C9%FA%B3%CC%D0%F2%C9%E8%BC%C6%BE%BA%C8%FC+-+%CD%F8%C2%E7%D1%A1%B0%CE%C8%FC&source=1&searchmode=source)

# Solutions

## E. CaoHaha's staff

签到题，找规律打表即可。

## F. Subsequence Count

**题目大意**：给定一个长度为 $n$ 的 $0/1$ 串，和 $q$ 次操作，操作分为两种：

- 翻转 $[l,r]$ 中的每一位
- 计算 $[l,r]$ 中本质不同的子序列个数

**题解**：我们先考虑怎么计算 $[1,n]$ 的本质不同的子序列个数。我们令 $dp[i][0/1]$ 表示到第 $i$ 位为止，以 $0/1$ 结尾的本质不同的子序列的个数。如果第 $i$ 位是 $0/1$，那么显然有：

$$
\begin{aligned}
dp[i][0/1] &= dp[i-1][0] + dp[i-1][1] + 1\\
dp[i][1/0] &= dp[i-1][1/0]
\end{aligned}
$$

其中 $dp[0][0]=dp[0][1]=0$。容易发现第 $i$ 位从 $i-1$ 位而来的转移方程，只与第 $i$ 位是 $0$ 还是 $1$有关，我们用矩阵乘法来表示这个状态转移：

$$
\left( \begin{array}{ccc}
dp_{i-1,0} & dp_{i-1,1} & 1
\end{array} \right) \cdot \mathbf{M_{0/1}}=
\left( \begin{array}{ccc}
dp_{i,0} & dp_{i,1} & 1
\end{array} \right)
$$

其中 $\mathbf{M_0},\mathbf{M_1}$ 分别表示第 $i$ 位是 $0/1$ 的转移矩阵。

$$
\mathbf{M_0} =
\left( \begin{array}{ccc}
1 & 0 & 0 \\
1 & 1 & 0 \\
1 & 0 & 1
\end{array} \right),
\mathbf{M_1} =
\left( \begin{array}{ccc}
1 & 1 & 0 \\
0 & 1 & 0 \\
0 & 1 & 1
\end{array} \right)
$$

那么我们每次询问区间 $[l,r]$ 的时候，只需要知道 $\mathbf{A}=\prod_{i=l}^r \mathbf{M_{s[i]}}$，那么有：

$$
\left( \begin{array}{ccc}
0 & 0 & 1
\end{array} \right) \cdot \mathbf{A}=
\left( \begin{array}{ccc}
dp_{r,0} & dp_{r,1} & 1
\end{array} \right)
$$

我们用一个线段树来维护这个乘积即可。对于修改操作，我们只需要将对应的矩阵的前两列交换，再将前两行交换即可。

## G. Palindrome Function

签到题，数位 dp 。

## I. The Designer

**题目大意**：给你两个内切的圆，然后在它们相切的缝隙中依次添加一些小圆和已有的圆相切（具体见题图），求添加 $n$ 个小圆的总面积。

![](http://acm.hdu.edu.cn/data/images/C779-1009-1.png)

**题解**：为讨论方便，只考虑一侧的小圆。设较大的圆半径为 $R$ ，较小的圆半径为 $r$ ，第 $i$ 个小圆半径为 $r_{i}$ 。根据 [Descartes' theorem](https://en.wikipedia.org/wiki/Descartes%27_theorem)，和这三个圆都相切的圆的半径 $x$ 满足：

$$
(\frac{1}{r}+\frac{1}{x}+\frac{1}{r_{i}}-\frac{1}{R})^{2}=2(\frac{1}{r^2}+\frac{1}{x^2}+\frac{1}{r_{i}^2}+\frac{1}{R^2})
$$ 

我们就得到了一个二次方程，它的两个根恰好是 $r_{i-1}$ 和 $r_{i+1}$ ，所以根据韦达定理有 $\displaystyle \frac{1}{r_{i+1}}=\frac{2}{r}+\frac{2}{r_{i}}-\frac{2}{R}-\frac{1}{r_{i-1}}$ 。由于 $T\cdot n$ 太大，直接计算完 $n$ 会超时，所以当小圆很小时（具体来说，应该比精度限制还要小，因为如果在当前圆停止计算，精度误差应该是剩下的所有小圆的面积和），要停止计算。

## K. Convolution Layer

**题目大意**：给你两个四维矩阵 $I\in {\{-1, 1\}}^{n\times c\times h_i\times w_i}$ 和 $W\in {\{-1, 1\}}^{m\times c\times h_w\times w_w}$。让你求 $O\in \mathbb{R}^{n\times m\times h_o\times w_o}$，其中 $h_o=h_i-h_w+1,w_o=w_i-w_w+1$，并且有：

$$
O[i][j][x][y]=\sum_{k=0}^{c-1}\sum_{i'=0}^{h_w-1}\sum_{j'=0}^{w_w-1}I[i][k][x+i'][y+j']\cdot W[j][k][i'][j']
$$

要求输出：

$$
\sum_{i=0}^{n-1}\sum_{j=0}^{m-1}\sum_{x=0}^{h_o-1}\sum_{y=0}^{w_o-1}O[i][j][x][y]\cdot f(i, j, x, y)
$$

其中 $f(i, j, x, y)$ 是一个关于 $i, j, x, y$ 的函数。

**题解**：我们交换枚举的顺序，先枚举 $i, j, k$，那么要求的就是一个经典的问题：在一个大矩阵（$I[i][k]$）中，对于小矩阵（$W[j][k]$）能放的每个位置（$x, y$），求一个对应位置的乘积的和，再乘上一个关于 $i,j,x,y$ 的函数。因为矩阵元素只有 $-1,1$，并且观察到负负得正的性质和异或相同，所以我们分别用 $1/0$ 来替代 $-1/1$。然后对大矩阵的每一行压位，对小矩阵整个串起来压位。小矩阵的大小是 $11\times 11=121$ 的，所以可以用 `__int128` 压位。

接下来枚举列 $y$，然后逆序枚举 $x$，将以 $(x,y)$ 为左上角的子矩形从 $I[i][k]$ 中抠出来，然后与 $W[j][k]$ 异或。$x$ 变化的时候只需要删除一行，再添加一行。复杂度为 $\mathcal{O}(n\cdot m\cdot c\cdot h_ow_o\cdot h_ww_w/32)$。对 $I[i][k]$ 的行压位时，因为只有 $56$ 位，所以用 `long long` 会快一些。

# Replay and Summary

## Replay

D 上来看了看 C 题和 D 题，然后让 W 来做 D 这个字符串。D 说直接后缀自动机建好跑一次就可以了，然后 W 写了之后直接 re。仔细看题发现有大写字母，开始改，然后隐约觉得不对劲但还是交了，然后就 tle 了，因为 52 的数组常数太大。W 决定从头好好想想，然后 D 去想 C 题。

过了一会儿 W 觉得直接 kmp 就能写了，就开始写，写完之后就 a 掉了。D 在想 C 题的时候，W 说了一句这不是离散书上的那题吗，当 n >= 6 的时候无解。然后 D 没听明白，W 也否认了自己的看法。导致 D 去讨论各种情况还 mle 了一次。改了改也过掉了。

Z 默默看题一直到这个时候，然后觉得 E 题打个表就行了结果打表打少了又 wa 了一次。然后 Z 开始写 G 题这道数位 dp。写完也过掉了。

过掉四题的弊队开始爆炸。这时开了 A F I 三题。A 题简单画了画图不太会，F 题是真的不会， I 题 Z 本来想预处理，但是发现空间很小，然后就想二分，又觉得会超时。就一直僵硬到了最后一个小时。

W 先是觉得 A 题 m=0 就行了，结果题目很不讲道理地又没说 m 不等于 0，又不让过。W 又想起了之前被否认的二分图，看了看 A 题题目给出的 wiki，然后构造了一发就过了。接下来的时间 W 和 D 在 F 和 H 之间徘徊，还是做不出来，而 Z 在不断地提交 I 题，一直 wa 和 tle。

## coldwater

感觉没什么好说的，就是太多东西不会了，太多定理不知道，还是得学习一个。

## ShinriiTin

## zhongzihao

太菜了，菜到没话说，还是滚去补题和刷题吧。

update:其实 J 还是会做的，当时不应该去写计算几何，虽然这么说有点马后炮就是了。