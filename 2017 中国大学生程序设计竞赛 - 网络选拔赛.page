# Contest Info

date 2017.08.19 12:00-17:00

[practice link](http://acm.hdu.edu.cn/search.php?field=problem&key=2017%D6%D0%B9%FA%B4%F3%D1%A7%C9%FA%B3%CC%D0%F2%C9%E8%BC%C6%BE%BA%C8%FC+-+%CD%F8%C2%E7%D1%A1%B0%CE%C8%FC&source=1&searchmode=source)

# Solutions

## K. Convolution Layer

**题目大意**：给你两个四维矩阵 $I\in {\{-1, 1\}}^{n\times c\times h_i\times w_i}$ 和 $W\in {\{-1, 1\}}^{m\times c\times h_w\times w_w}$。让你求 $O\in \mathbb{R}^{n\times m\times h_o\times w_o}$，其中 $h_o=h_i-h_w+1,w_o=w_i-w_w+1$，并且有：

$$
O[i][j][x][y]=\sum_{k=0}^{c-1}\sum_{i'=0}^{h_w-1}\sum_{j'=0}^{w_w-1}I[i][k][x+i'][y+j']\cdot W[j][k][i'][j']
$$

要求输出：

$$
\sum_{i=0}^{n-1}\sum_{j=0}^{m-1}\sum_{x=0}^{h_o-1}\sum_{y=0}^{w_o-1}O[i][j][x][y]\cdot f(i, j, x, y)
$$

其中 $f(i, j, x, y)$ 是一个关于 $i, j, x, y$ 的函数。

**题解**：我们交换枚举的顺序，先枚举 $i, j, k$，那么要求的就是一个经典的问题：在一个大矩阵（$I[i][k]$）中，对于小矩阵（$W[j][k]$）能放的每个位置（$x, y$），求一个对应位置的乘积的和，再乘上一个关于 $i,j,x,y$ 的函数。因为矩阵元素只有 $-1,1$，并且观察到负负得正的性质和异或相同，所以我们分别用 $1/0$ 来替代 $-1/1$。然后对大矩阵的每一行压位，对小矩阵整个串起来压位。小矩阵的大小是 $11\times 11=121$ 的，所以可以用 `__int128` 压位。

接下来枚举列 $y$，然后逆序枚举 $x$，将以 $(x,y)$ 为左上角的子矩形从 $I[i][k]$ 中抠出来，然后与 $W[j][k]$ 异或。$x$ 变化的时候只需要删除一行，再添加一行。复杂度为 $\mathcal{O}(n\cdot m\cdot c\cdot h_ow_o\cdot h_ww_w/32)$。

# Replay and Summary

## Replay

D 上来看了看 C 题和 D 题，然后让 W 来做 D 这个字符串。D 说直接后缀自动机建好跑一次就可以了，然后 W 写了之后直接 re。仔细看题发现有大写字母，开始改，然后隐约觉得不对劲但还是交了，然后就 tle 了，因为 52 的数组常数太大。W 决定从头好好想想，然后 D 去想 C 题。

过了一会儿 W 觉得直接 kmp 就能写了，就开始写，写完之后就 a 掉了。D 在想 C 题的时候，W 说了一句这不是离散书上的那题吗，当 n >= 6 的时候无解。然后 D 没听明白，W 也否认了自己的看法。导致 D 去讨论各种情况还 mle 了一次。改了改也过掉了。

Z 默默看题一直到这个时候，然后觉得 E 题打个表就行了结果打表打少了又 wa 了一次。然后 Z 开始写 G 题这道数位 dp。写完也过掉了。

过掉四题的弊队开始爆炸。这时开了 A F I 三题。A 题简单画了画图不太会，F 题是真的不会， I 题 Z 本来想预处理，但是发现空间很小，然后就想二分，又觉得会超时。就一直僵硬到了最后一个小时。

W 先是觉得 A 题 m=0 就行了，结果题目很不讲道理地又没说 m 不等于 0，又不让过。W 又想起了之前被否认的二分图，看了看 A 题题目给出的 wiki，然后构造了一发就过了。接下来的时间 W 和 D 在 F 和 H 之间徘徊，还是做不出来，而 Z 在不断地提交 I 题，一直 wa 和 tle。

## coldwater

感觉没什么好说的，就是太多东西不会了，太多定理不知道，还是得学习一个。

## ShinriiTin

## zhongzihao

太菜了，菜到没话说，还是滚去补题和刷题吧。

update:其实 J 还是会做的，当时不应该去写计算几何，虽然这么说有点马后炮就是了。