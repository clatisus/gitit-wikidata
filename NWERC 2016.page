# Contest Info

date: 2018.08.12 12:00-17:00

[practice link](https://cn.vjudge.net/contest/245486)

# Solutions

## B. British Menu 

**题目大意**：给出一个 $n\le10^5$ 个点和 $m\le10^6$ 条边的有向图，满足图中所有的 scc 大小都不超过 $5$，求最长的简单路径的点数。

**题解**：因为 scc 大小很小，所以可以暴力求出 scc 内部任意两个点作为起点和终点的最长路径长度，之后可以在缩点后的 DAG 上进行 dp ，需要枚举每个 scc 进入和离开的节点进行转移。

时间复杂度 $\mathcal{O}((n+m)\times5\times2^5)$。

## D. Driving in Optimistan

**题目大意**：给出一棵树的 $n(n\leq 500)$ 个叶子间两两的距离（距离最大值 $10^6$ ），原树所有的边长为 $1$。问原树中所有点对的距离的平均值。

**题解**：如果能建出原树，那么我们计算每条边两端的 size 乘积，便是它的贡献。但是原树点可能非常多，所以我们只考虑增加 $n-1$ 个点。

我们把 $1$ 提起来作为根，然后计算出其余所有点对的 lca 到 $1$ 的距离，然后每次新建距离最大的 lca。点对 $(u,v)$ 的 lca 到 $1$ 的距离为 $\displaystyle \frac{\text{dis}[1][u]+\text{dis}[1][v]-\text{dis}[u][v]}{2}$，同时我们也可以算出 $u,v$ 分别到 lca 的距离。

树建好之后，我们先 dfs 算出 size，这里的 size 是不包括根的点数，那么我们设 $m=\text{size}[1]+1$，对于 $u$ 到 $v$ 的一条长度为 $w$ 的边，它的贡献为：

$$
\sum_{i=1}^w(\text{size}[v]+i)\left((m-\text{size}[v]-w)+w-i\right)
$$

## E. Exam Redistribution

签到题

## F. Free Weights  

**题目大意**：有两行数字，每行有 $n\le10^6$ 个数，这 $2n$ 个数中每种数字恰好有两个，值域 $[0,10^9]$ 。最小化需要移动的最大数字，使得每对相同的数字都相邻。移动后每行的数字数量不同也合法。

**题解**：二分答案，然后将所有不超过答案的数字都删去判断剩下的数字是否满足条件即可。时间复杂度 $\mathcal{O}(n\log \text{ans})$。

## H. Hamiltonian Hypercube

**题目大意**：求两个 Gray Code 的距离。

**题解**：考虑 Gray Code 的镜射构造过程，最高位为 $1$ 的时候，用 $2^n-1$ 减掉递归的答案。

## I. Iron and Coal

**题目大意**：$n$ 个点的有向图，有的点有煤矿，有的点有铁矿。问连接 $1$ 号点和至少一个煤矿一个铁矿的最少点数。

**题解**：把所有的煤矿连向一个点，铁矿连向另一个点，即求三个点的 Steiner Tree。bfs 三次求出最短路，然后枚举一个点拼起来。

## J. Jupiter Orbiter

**题目大意**：$q$ 个队列，每个队列有一个最大的容量 $c_i$。 $s$ 个传感器，每个传感器绑定了一个队列。 $n$ 次事件，第 $i$ 次事件为每个传感器往绑定的队列生成 $a_{ij}$ 的数据。数据都生成结束之后，$q$ 个队列一共可以下载 $d_i$ 的数据。问是否存在一种方案，可以不遗失所有的数据。

**题解**：最大流。我们把每个队列在每天建一个点，然后把这个点拆成两个点，共 $2qn$ 个点。入点向出点连 $c_i$ 的容量，同一个队列，前一天的出点向后一天的入点连 $\infty$ 的容量。每个事件建一个点，向汇点连 $d_i$ 的容量。每个队列每天的出点连事件点 $\infty$ 的容量。源点连每个队列每天的入点该天的总数据量。

最后判断最大流是否等于生成的总数据量即可。

# Dirt Replay

F: `-1` D 瞎想了一个不是最优的做法

C: `-1` Z 输出速度的时候取了 abs

B: `-3` dp 的时候没有加以 scc 为结尾的贡献；dfs 只从 1 开始