# Contest Info

date: 2018.11.08 19:49-24:49

practice link: opentrains 10392

# Solutions

## A. Nutella's Life

**题目大意：** 求解这样一个 dp

$$
\text{dp}[i] = \max_{j<i,a_j\leq a_i} (\text{dp}[j] - \frac{(i-j)(i-j-1)}{2})+a_i
$$

**题解：** 离散化 $a$ 之后，树状数组套上双端队列然后斜率 dp。一个 $\log$。

## C. Christmas Garland

**题目大意**：

有$n\le2\times10^5$盏灯排成一行，第$i$盏灯的颜色为$a_i$，初始情况所有灯都是灭的.

$q\le2\times10^5$次操作，每次选择一种颜色，将这种颜色的所有灯的开关状态取反，之后询问有多少段极大的连续亮灯。

**题解**：

答案等价于求和每个位置它自己亮着且前一个位置没有亮着。

添加头尾两个额外的位置（颜色与其它位置不同且灯一直不亮），给相邻的两个颜色建无向边。

则等价于问图中多少条边的两端状态不同，然后答案除以二。

这样就是每次改变一个点，分度数大小是否超过$O(\sqrt{n})$处理一下即可。

时间复杂度$O(n\sqrt{n})$，空间复杂度$O(n)$.

## F. Secret Permutation

**题目大意：** 交互题。有一个排列 $p_0,\dots,p_{n-1}$。 $n\leq 5000$。每次问 $(a,b,c)$，回答 $p^{-1}(p_a\cdot p_b+p_c)$。最多问 $12512$ 次。

**题解：**在 $p^{-1}$ 里面构造出 $0$，那么就可以找到 $0$ 的位置。容易发现 $p_0(p_0+1)\cdots (p_{n-1}+1)$ 就是 $0$，那么我们问 $(x,i,x)(1\leq i\leq n)$，其中 $x$ 是上次的结果（初值为 $0$）。找到 $0$ 之后，我们在剩下的位置中随机挑选两个位置 $a,b$，然后问 $(a,b,\text{pos}_0)$，如果答案是 $a$，那么 $b$ 还有可能是 $1$，把 $b$ 放回去；答案是 $b$ 同理。一直到最后只剩下一个数字，那么它就是 $1$ 的位置。

我们接着问 $(\text{pos}_1,\text{pos}_{i-1},\text{pos}_1)$，可以得到 $\text{pos}_i$。找到 $0$ 和最后找到所有数字大概用了 $10000$ 次，中间找 $1$ 感受一下是 $\frac{n}{2}$ 的。随机种子用 W 和 Z 的生日都过了。还要特殊判断一下 $n=1$。

## K. Robotobor

**题目大意**：

在一个$n\times m$的网格图中，$n,m\le50$，有一些格子是障碍，有一个唯一的起点$S$和一个唯一的终点$T$.

定义一个路径为回文的，当且仅当这个路径总步数不超过$100$且它表示为$L,R,U,D$（向左一步，向右一步，向上一步，向下一步）的序列是回文的。

最小化从$S$走到$T$经过的路径数，输出方案。

**题解**：

首先求出出任意起点任意终点是否存在合法的回文路径，从路径$(u,u)$和$(u,v)$（$u$和$v$）相邻开始`bfs`，每次枚举一个方向向两端扩展即可。

然后再从`s`开始`bfs`一次就可以求出任意终点的答案。

输出方案只需记录两次`bfs`时的前驱即可。

时空复杂度$O(n^2m^2)$.